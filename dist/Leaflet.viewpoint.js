L.SVG.include({_createArrows:function(t){var r=t.options,e=r.directions,i,o;if(!e||!e.length){return}for(var s=0,i=e.length;s<i;s++){o=this._createArrow(e[s],r);t.addInteractiveTarget(o);t._arrows.push(o)}},_createArrow:function(t,r){var e=L.SVG.create("path"),i=r.arrow;L.DomUtil.addClass(e,"leaflet-interactive");e.setAttribute("id",r.id+"-"+t);e.angle=t;this._updateArrowStyle(e,i);return e},_updateArrowsStyle:function(t){var r=t._arrows,e=t.options.arrow,i=r.length;for(var o=0;o<i;o++){this._updateArrowStyle(r[o],e)}},_updateArrowStyle:function(t,r){if(r.stroke){t.setAttribute("stroke",r.color);t.setAttribute("stroke-width",r.weight);t.setAttribute("stroke-opacity",r.opacity)}else{t.setAttribute("stroke","none")}if(r.fill){t.setAttribute("fill",r.fillColor);t.setAttribute("fill-opacity",r.fillOpacity)}else{t.setAttribute("fill","none")}},_updateArrows:function(t){var r=t._arrows,e=t.options.arrow,i=r.length,o=this._rootGroup;for(var s=0;s<i;s++){this._updateArrowPath(r[s],t);o.appendChild(r[s])}},_updateArrowPath:function(t,r){var e=r.options.arrow,i=e.width,o=e.height,s=e.offset,n=r._radius,a=r._point.x,h=r._point.y,l=t.angle,u=-(n+s)*Math.sin(l*Math.PI/180)-i/2*Math.sin((90-l)*Math.PI/180),d=(n+s)*Math.cos(l*Math.PI/180)-i/2*Math.cos((90-l)*Math.PI/180);t.setAttribute("d","M 0 0 L "+i+" 0 L "+i/2+" "+o+" z");t.setAttribute("width",e.width);t.setAttribute("transform","translate("+(a+u)+","+(h+d)+") "+"rotate("+l+")");return t},_removeArrows:function(t){var r=t._arrows,e=r.length,i=this._rootGroup;for(var o=0;o<e;o++){i.removeChild(r[o])}t._arrows=[]}});L.Viewpoint=L.CircleMarker.extend({options:{id:null,arrow:{width:8,height:16,offset:3,stroke:false,color:null,weight:0,opacity:1,fill:true,fillColor:"black",fillOpacity:1},directions:[]},initialize:function(t,r){this.setOptions(this,r);if(!r.id){this.options.id=L.stamp(this)}this._arrows=[];L.CircleMarker.prototype.initialize.call(this,t,this.options)},onAdd:function(){this._renderer._createArrows(this);L.CircleMarker.prototype.onAdd.call(this)},onRemove:function(){this._renderer._removeArrows(this);L.CircleMarker.prototype.onRemove.call(this)},setOptions:function(t,r){for(var e in r){if(e==="arrow"){t.options[e]=L.extend({},t.options[e],r[e])}else{t.options[e]=r[e]}}return t.options},setArrowStyle:function(t){var r=this.options.arrow;for(var e in t){r[e]=t[e]}if("width"in t||"height"in t||"offset"in t){this._renderer._updateArrows(this)}this._renderer._updateArrowsStyle(this);return this},setDirections:function(t){this.options.directions=t;this._resetArrows();return this},getDirections:function(){return this.options.directions},_resetArrows:function(){this._renderer._removeArrows(this);this._renderer._createArrows(this);this._renderer._updateArrows(this)},_updatePath:function(){this._renderer._updateCircle(this);this._renderer._updateArrows(this)}});L.viewpoint=function(t,r){return new L.Viewpoint(t,r)};